<!DOCTYPE html>
<html>
<head>
    <title>Park My Car</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
    body,h1,h2,h3,h4,h5 {font-family: "Poppins", sans-serif}
    body {font-size: 16px;}
    img {margin-bottom: -8px;}
    .mySlides {display: none;}
    .w3-bar .w3-button {
        padding: 16px;
    }
    .modal {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: 1; /* Sit on top */
      left: 0;
      top: 0;
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      overflow: auto; /* Enable scroll if needed */
      background-color: rgb(0,0,0); /* Fallback color */
      background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
  }

  /* Modal Content/Box */
  .modal-content {
      background-color: #fefefe;
      margin: 15% auto; /* 15% from the top and centered */
      padding: 20px;
      border: 1px solid #888;
      width: 80%; /* Could be more or less, depending on screen size */
  }

  /* The Close Button */
  .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
  }

  .close:hover,
  .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
  }
</style>
</head>
<body class="w3-content w3-black" style="max-width:1500px;">

    <!-- Navbar (sit on top) -->
    <div class="w3-top">
        <div class="w3-bar w3-white w3-card" id="myNavbar">
            <a href="#home" class="w3-bar-item w3-button w3-wide">PARK MY CAR</a>
            <!-- Right-sided navbar links -->
            <div class="w3-right w3-hide-small">
                <a href="Login.html" class="w3-bar-item w3-button"><i class="fa fa-user"></i> REGISTER YOUR GARAGE</a>
            </div>
            <!-- Hide right-floated links on small screens and replace them with a menu icon -->

            <a href="javascript:void(0)" class="w3-bar-item w3-button w3-right w3-hide-large w3-hide-medium" onclick="w3_open()">
                <i class="fa fa-bars"></i>
            </a>
        </div>
    </div>
    
    <!-- Sidebar on small screens when clicking the menu icon -->
    <nav class="w3-sidebar w3-bar-block w3-black w3-card w3-animate-left w3-hide-medium w3-hide-large" style="display:none" id="mySidebar">
        <a href="javascript:void(0)" onclick="w3_close()" class="w3-bar-item w3-button w3-large w3-padding-16">Close Ã—</a>
        <a href="Login.html" class="w3-bar-item w3-button"><i class="fa fa-user"></i> REGISTER YOUR GARAGE</a>
    </nav>

    <!-- Header with Slideshow -->
    <header class="w3-display-container w3-center">
        <button class="w3-button w3-block w3-green w3-hide-large w3-hide-medium" onclick="document.getElementById('download').style.display='block'">Download <i class="fa fa-android"></i> <i class="fa fa-apple"></i> <i class="fa fa-windows"></i></button>
        <div class="mySlides w3-animate-opacity">
            <img class="w3-image" src="Parking-lot.jpg" alt="Image 1" style="min-width:500px" width="1500" height="1000">
            <div class="w3-display-left w3-padding w3-hide-small" style="width:40%">
                <div class="w3-black w3-opacity w3-hover-opacity-off w3-padding-large w3-round-large">
                    <h1 class="w3-xlarge">Find the nearest available parking spot</h1>
                    <hr class="w3-opacity">
                    <select id="location_dropdown">
                        <option selected disabled>choose location</option>
                    </select>
                    <div id="availability"></div>
                    <p><button id="myBtn" class="w3-button w3-block w3-green w3-round">Reserve Spot<i class="fa fa-search"></i></button></p>
                    <!-- Trigger/Open The Modal -->
                    


                </div>
            </div>
        </div>
    </header>
    <!-- The Modal -->
    <div id="myModal" class="modal" style="width:50%; position: absolute; top: 30%; left: 30%; margin-top: -5%; margin-left: -5%;">

      <!-- Modal content -->
      <div class="modal-content" style="color: black;">
        <span class="close">&times;</span>
        <div id="modal_address"></div>
        <form>
            <p id="address_name"></p>
            
            <div style="float:left;">
                <label style="text-align: center;"for="reserve_username">Name: </label>
                <input type="text" name="parking_username" id="parking_username"> </input>
            </div>
            <br>
            <br>
            <div style="float:left;">
                <label for="reserve_phoneno">Phone No: </label>
                <input type="text" name="phoneno" id="phoneno"></input>
            </div>
            <br>
            <p><button id="reserveBtn" onclick="reserveSpot()" class="w3-button w3-block w3-green w3-round">Reserve Spot</button>
            <!-- Name:&nbsp;<input type="text" name="parking_username" id="parking_username"> </input><br> -->
            <!-- Phone No: <input type="text" name="phoneno" id="phoneno"></input><br> -->
        </form>
    </div>

</div> 

<!-- Footer -->
<footer class="w3-container w3-padding-32 w3-light-grey w3-center w3-xlarge">
    <div class="w3-section">
        <i class="fa fa-facebook-official w3-hover-opacity"></i>
        <i class="fa fa-instagram w3-hover-opacity"></i>
        <i class="fa fa-snapchat w3-hover-opacity"></i>
        <i class="fa fa-pinterest-p w3-hover-opacity"></i>
        <i class="fa fa-twitter w3-hover-opacity"></i>
        <i class="fa fa-linkedin w3-hover-opacity"></i>
    </div>
</footer>

<script>
            // Slideshow
            var slideIndex = 1;
            showDivs(slideIndex);

            // function plusDivs(n) {
            // showDivs(slideIndex += n);
            // }

            function showDivs(n) {
                var i;
                var x = document.getElementsByClassName("mySlides");
                if (n > x.length) {slideIndex = 1}
                    if (n < 1) {slideIndex = x.length}
                        for (i = 0; i < x.length; i++) {
                            x[i].style.display = "none";  
                        }
                        x[slideIndex-1].style.display = "block";  
                    }

                    $('#location_dropdown').change(function(){
                        res={'parking_garage_id' : document.getElementById("location_dropdown").value}
                        $.ajax('http://0.0.0.0:5000/checkAvailability', {
                            type: 'post',
                            data: JSON.stringify(res),
                            dataType: 'json',
                            contentType: 'application/json',
                            success: function(data) { 
                                if (data.availability == 'Y'){
                                    document.getElementById("availability").innerHTML = 'Available';
                                    document.getElementById("availability").style.color = 'green';
                                    // $('#myBtn').show();
                                }else{
                                    document.getElementById("availability").innerHTML = 'Not Available';
                                    document.getElementById("availability").style.color = 'red';
                                    // $('#myBtn').hide();
                                }
                            },
                            error: function (textStatus, errorThrown) {
                               document.getElementById("availability").innerHTML = 'Not Available';
                               document.getElementById("availability").style.color = 'red';
                           }
                       });
                 // prevent further bubbling of event
             });

                    function reserveSpot() {
                        res={'parking_garage_id' : document.getElementById("location_dropdown").value , 'username' : 'user' , 'phoneno' : '8888888'}
                        $.ajax('http://0.0.0.0:5000/reserveSpot', {
                            type: 'post',
                            data: JSON.stringify(res),
                            dataType: 'json',
                            contentType: 'application/json',
                            success: function(data) { 
                                if (data.availability == 'Y'){
                                    alert(data.parking_spot_name)
                                }else{
                                    document.getElementById("availability").innerHTML = 'Not Available';
                                    document.getElementById("availability").style.color = 'red';
                                    $('#myBtn').toggle(false);
                                }
                            },
                            error: function (textStatus, errorThrown) {
                               document.getElementById("availability").innerHTML = 'Not Available';
                               document.getElementById("availability").style.color = 'red';
                               document.getElementById('myModal').style.display = "none";
                           }
                       });
                return false; // prevent further bubbling of event
            }
            $(document).ready(function () {
                // $('#myBtn').hide();
                var dropdown = document.getElementById("location_dropdown");
                var locations = {};
                var api_url = 'http://localhost:8080/api/getAllGarages';
                $.ajax({ 
                    type:'GET',
                    dataType:'json',
                    url: api_url,
                    success: function(garages) {
                        console.log(garages);
                        garages.forEach(element => {
                            var opt = document.createElement("option");
                            opt.value= element.parkingGarageId;
                            opt.innerHTML = element.address + ', '+element.city+','+element.pincode; // whatever property it has
                            console.log(element);
                            console.log(opt);
                            // then append it to the select element
                            dropdown.appendChild(opt);
                        })
                    },
                    error: function (textStatus, errorThrown) {
                        console.log(textStatus);
                        console.log(errorThrown);
                    }
                });
            });
        </script>
        <script type="text/javascript">
            // Get the modal
            var modal = document.getElementById('myModal');

// Get the button that opens the modal
var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks on the button, open the modal
btn.onclick = function() {
  modal.style.display = "block";
  document.getElementById('address_name').innerHTML = $( "#location_dropdown option:selected" ).text();
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
}
} 
</script>
</body>
</html>